<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zerograv Main Page</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Willkommen bei Zerograv</h1>
        <nav>
            <ul>
                <li><a href="http://app.zerograv.xyz">Zur App</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <p>Hier k√∂nnte Ihre Inhaltsbeschreibung stehen.</p>
        <button id="walletButton" onclick="connectOrDisconnect();">Connect Wallet</button>
        <button id="switchNetworkButton" onclick="switchToSepolia();" style="display: none;">Switch to Sepolia</button>
        <br>
        <div id="networkDisplay">Connected Network: -</div>
        <br>
        <div id="mintInfo">Minted: 0 / Left: 0</div>
        <br>
        <button id="mintButton" onclick="mintNFT();" disabled>Mint NFT</button>
    </main>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="text/javascript"></script>
    <script>
        // Replace '... Contract ABI ...' with the actual ABI for your contract
        const contractABI = ["[{\"type\":\"constructor\",\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"_scriptyStorageAddress\"},{\"type\":\"address\",\"name\":\"_scriptyBuilderAddress\"}]},{\"type\":\"event\",\"anonymous\":false,\"name\":\"Approval\",\"inputs\":[{\"type\":\"address\",\"name\":\"owner\",\"indexed\":true},{\"type\":\"address\",\"name\":\"approved\",\"indexed\":true},{\"type\":\"uint256\",\"name\":\"tokenId\",\"indexed\":true}]},{\"type\":\"event\",\"anonymous\":false,\"name\":\"ApprovalForAll\",\"inputs\":[{\"type\":\"address\",\"name\":\"owner\",\"indexed\":true},{\"type\":\"address\",\"name\":\"operator\",\"indexed\":true},{\"type\":\"bool\",\"name\":\"approved\",\"indexed\":false}]},{\"type\":\"event\",\"anonymous\":false,\"name\":\"OwnershipTransferred\",\"inputs\":[{\"type\":\"address\",\"name\":\"previousOwner\",\"indexed\":true},{\"type\":\"address\",\"name\":\"newOwner\",\"indexed\":true}]},{\"type\":\"event\",\"anonymous\":false,\"name\":\"Transfer\",\"inputs\":[{\"type\":\"address\",\"name\":\"from\",\"indexed\":true},{\"type\":\"address\",\"name\":\"to\",\"indexed\":true},{\"type\":\"uint256\",\"name\":\"tokenId\",\"indexed\":true}]},{\"type\":\"function\",\"name\":\"MINT_PRICE\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"approve\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"to\"},{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"balanceOf\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"owner\"}],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"getApproved\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"isApprovedForAll\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"owner\"},{\"type\":\"address\",\"name\":\"operator\"}],\"outputs\":[{\"type\":\"bool\"}]},{\"type\":\"function\",\"name\":\"maxSupply\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"mint\",\"constant\":false,\"stateMutability\":\"payable\",\"payable\":true,\"inputs\":[{\"type\":\"address\",\"name\":\"to\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"name\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"owner\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"ownerOf\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"render_3d\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"_tokenTransferCount\"},{\"type\":\"uint256\",\"name\":\"_tokenMintTimestamp\"},{\"type\":\"uint256\",\"name\":\"_lastTransferTimestamp\"},{\"type\":\"uint256\",\"name\":\"_totalTradeVolume\"},{\"type\":\"uint256\",\"name\":\"_tokenID\"}],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"render_deck\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"_tokenTransferCount\"},{\"type\":\"uint256\",\"name\":\"_tokenMintTimestamp\"},{\"type\":\"uint256\",\"name\":\"_lastTransferTimestamp\"},{\"type\":\"uint256\",\"name\":\"_totalTradeVolume\"},{\"type\":\"uint256\",\"name\":\"_tokenID\"}],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"render_schrift\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"_tokenTransferCount\"},{\"type\":\"uint256\",\"name\":\"_tokenMintTimestamp\"},{\"type\":\"uint256\",\"name\":\"_lastTransferTimestamp\"},{\"type\":\"uint256\",\"name\":\"_totalTradeVolume\"},{\"type\":\"uint256\",\"name\":\"_tokenID\"}],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"renounceOwnership\",\"constant\":false,\"payable\":false,\"inputs\":[],\"outputs\":[]},{\"type\":\"function\",\"name\":\"royaltyInfo\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"_tokenId\"},{\"type\":\"uint256\",\"name\":\"_salePrice\"}],\"outputs\":[{\"type\":\"address\",\"name\":\"receiver\"},{\"type\":\"uint256\",\"name\":\"royaltyAmount\"}]},{\"type\":\"function\",\"name\":\"safeTransferFrom\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"from\"},{\"type\":\"address\",\"name\":\"to\"},{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"safeTransferFrom\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"from\"},{\"type\":\"address\",\"name\":\"to\"},{\"type\":\"uint256\",\"name\":\"tokenId\"},{\"type\":\"bytes\",\"name\":\"data\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"scriptyBuilderAddress\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"scriptyStorageAddress\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"setApprovalForAll\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"operator\"},{\"type\":\"bool\",\"name\":\"approved\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"setRoyaltyReceiver\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"_receiver\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"supportsInterface\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"bytes4\",\"name\":\"interfaceId\"}],\"outputs\":[{\"type\":\"bool\"}]},{\"type\":\"function\",\"name\":\"symbol\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"tokenData\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\"}],\"outputs\":[{\"type\":\"uint256\",\"name\":\"transferCount\"},{\"type\":\"uint256\",\"name\":\"mintTimestamp\"},{\"type\":\"bytes32\",\"name\":\"seed\"},{\"type\":\"uint256\",\"name\":\"lastTransferTimestamp\"}]},{\"type\":\"function\",\"name\":\"tokenURI\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"totalMintedSoFar\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"totalTradeVolume\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"transferCount\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"transferFrom\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"from\"},{\"type\":\"address\",\"name\":\"to\"},{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"transferOwnership\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"newOwner\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"withdraw\",\"constant\":false,\"payable\":false,\"inputs\":[],\"outputs\":[]}]"];
        const contractAddress = "0xc9f0c7A6Fef896DeBd1628BDCEdeA21ff29a8576";
        const sepoliaChainId = '0x53'; // Hexadecimal representation of 11155111

        let connectedAccount = null;

        async function connectOrDisconnect() {
            if (connectedAccount) {
                // Disconnect the wallet
                connectedAccount = null;
                document.getElementById("walletButton").innerText = 'Connect Wallet';
                document.getElementById("mintButton").disabled = true;
                updateNetworkDisplay('-');
            } else {
                // Connect the wallet
                await connect();
            }
        }

        async function connect() {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
                    connectedAccount = accounts[0];
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const network = await provider.getNetwork();
                    updateWalletDisplay(connectedAccount);
                    updateNetworkDisplay(network.name);
                    document.getElementById("mintButton").disabled = false;
                    checkIfSepolia(network);
                    await updateMintInfo();
                } catch (error) {
                    console.error("Error connecting to wallet:", error);
                }
            } else {
                console.log("No Ethereum provider found. Install MetaMask.");
            }
        }

        async function switchToSepolia() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: sepoliaChainId }],
                });
                updateNetworkDisplay('Sepolia');
                document.getElementById('switchNetworkButton').style.display = 'none';
            } catch (switchError) {
                // This error code indicates that the chain has not been added to MetaMask.
                if (switchError.code === 4902) {
                    await addSepoliaNetwork();
                } else {
                    console.error("Error switching to Sepolia network: ", switchError);
                }
            }
        }

        async function addSepoliaNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: sepoliaChainId,
                        chainName: 'Sepolia Test Network',
                        nativeCurrency: {
                            name: 'Ether',
                            symbol: 'ETH', // 2-6 characters long
                            decimals: 18,
                        },
                        rpcUrls: ['https://rpc.sepolia.org/'],
                        blockExplorerUrls: ['https://sepolia.etherscan.io/'],
                    }],
                });
                updateNetworkDisplay('Sepolia');
            } catch (addError) {
                console.error("Failed to add Sepolia network: ", addError);
            }
        }

        function checkIfSepolia(network) {
            // Adjust to match the numeric chainId for Sepolia
            if (network.chainId !== 11155111) {
                document.getElementById('switchNetworkButton').style.display = 'inline-block';
            } else {
                document.getElementById('switchNetworkButton').style.display = 'none';
            }
        }

        function updateWalletDisplay(account) {
            const displayText = `${account.substring(0, 6)}...${account.substring(account.length - 4)}`;
            document.getElementById("walletButton").innerText = `Wallet: ${displayText}`;
        }

        function updateNetworkDisplay(networkName) {
            document.getElementById("networkDisplay").innerText = `Connected Network: ${networkName}`;
        }

        async function mintNFT() {
            if (!connectedAccount) {
                console.error("No connected account.");
                return;
            }

            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            const contract = new ethers.Contract(contractAddress, contractABI, signer);

            try {
                const tx = await contract.mint(connectedAccount);
                console.log("Mint transaction sent:", tx);
                await tx.wait();
                console.log("Mint transaction confirmed:", tx);
                await updateMintInfo();
            } catch (error) {
                console.error("Minting failed: ", error);
            }
        }

        async function updateMintInfo() {
            if (!connectedAccount) {
                console.error("No connected account for mint info update.");
                return;
            }
            
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const contract = new ethers.Contract(contractAddress, contractABI, provider);
            try {
                // Assuming 'totalSupply' is a function in your contract that returns the current number of minted NFTs
                const totalMinted = await contract.totalSupply();
                const mintInfo = `Minted: ${totalMinted.toString()} / Left: ${maxMints - totalMinted}`;
                document.getElementById("mintInfo").innerText = mintInfo;
            } catch (error) {
                console.error("Failed to get mint info: ", error);
            }
        }

        window.onload = () => {
            updateNetworkDisplay('-');
        };
    </script>
</body>
</html>
