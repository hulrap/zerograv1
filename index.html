<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zerograv Main Page</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Willkommen bei Zerograv</h1>
        <nav>
            <ul>
                <li><a href="http://app.zerograv.xyz">Zur App</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <p>Hier könnte Ihre Inhaltsbeschreibung stehen.</p>
        <button id="walletButton" onclick="connectOrDisconnect();">Connect Wallet</button>
        <br>
        <div id="mintInfo">Minted: 0 / Left: 0</div>
        <br>
        <button id="mintButton" onclick="mintNFT();" disabled>Mint NFT</button>
    </main>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="text/javascript"></script>
    <script>
        let totalMinted = 0; // Beispielwert, sollte dynamisch abgefragt werden
        const maxMints = 13; // Beispielwert, sollte dynamisch abgefragt werden
        let connectedAccount = null;

        async function connectOrDisconnect() {
            if (connectedAccount) {
                connectedAccount = null;
                document.getElementById("walletButton").innerText = 'Connect Wallet';
                document.getElementById("mintButton").disabled = true;
            } else {
                await connect();
            }
        }

        async function connect() {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
                    connectedAccount = accounts[0];
                    await checkNetwork();
                    updateWalletDisplay(connectedAccount);
                    document.getElementById("mintButton").disabled = false;
                } catch (error) {
                    console.error("Error connecting to wallet:", error);
                }
            } else {
                console.log("No Ethereum provider found. Install MetaMask.");
            }
        }

        async function checkNetwork() {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const { chainId } = await provider.getNetwork();
            if (chainId !== 11155111) { // Chain ID for Sepolia Testnet
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0xaa36b1' }], // Hexadecimal version of 11155111
                    });
                } catch (error) {
                    // This error code indicates that the chain has not been added to MetaMask.
                    if (error.code === 4902) {
                        try {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [
                                    {
                                        chainId: '0xaa36b1',
                                        chainName: 'Sepolia Test Network',
                                        rpcUrls: ['https://rpc.sepolia.org/'] // This is a public RPC for Sepolia
                                        // ... other parameters like block explorer URLs
                                    },
                                ],
                            });
                        } catch (addError) {
                            console.error("Failed to add the Sepolia test network:", addError);
                        }
                    } else {
                        console.error("Failed to switch to the Sepolia test network:", error);
                    }
                }
            }
        }

        function updateWalletDisplay(account) {
            const displayText = `${account.substring(0, 6)}...${account.substring(account.length - 4)}`;
            document.getElementById("walletButton").innerText = `Wallet: ${displayText}`;
        }

        async function updateMintInfo() {
            // Hier sollte der Code stehen, der die tatsächlich gemintete Anzahl abfragt
            const mintInfo = document.getElementById("mintInfo");
            mintInfo.innerText = `Minted: ${totalMinted} / Left: ${maxMints - totalMinted}`;
        }

        async function mintNFT() {
            if (!connectedAccount) {
                console.error("No connected account.");
                return;
            }

            // Fügen Sie hier den ABI und die Adresse Ihres Smart Contracts ein
            const contractAddress = "0xc9f0c7A6Fef896DeBd1628BDCEdeA21ff29a8576";
            const contractABI = ["[{\"type\":\"constructor\",\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"_scriptyStorageAddress\"},{\"type\":\"address\",\"name\":\"_scriptyBuilderAddress\"}]},{\"type\":\"event\",\"anonymous\":false,\"name\":\"Approval\",\"inputs\":[{\"type\":\"address\",\"name\":\"owner\",\"indexed\":true},{\"type\":\"address\",\"name\":\"approved\",\"indexed\":true},{\"type\":\"uint256\",\"name\":\"tokenId\",\"indexed\":true}]},{\"type\":\"event\",\"anonymous\":false,\"name\":\"ApprovalForAll\",\"inputs\":[{\"type\":\"address\",\"name\":\"owner\",\"indexed\":true},{\"type\":\"address\",\"name\":\"operator\",\"indexed\":true},{\"type\":\"bool\",\"name\":\"approved\",\"indexed\":false}]},{\"type\":\"event\",\"anonymous\":false,\"name\":\"OwnershipTransferred\",\"inputs\":[{\"type\":\"address\",\"name\":\"previousOwner\",\"indexed\":true},{\"type\":\"address\",\"name\":\"newOwner\",\"indexed\":true}]},{\"type\":\"event\",\"anonymous\":false,\"name\":\"Transfer\",\"inputs\":[{\"type\":\"address\",\"name\":\"from\",\"indexed\":true},{\"type\":\"address\",\"name\":\"to\",\"indexed\":true},{\"type\":\"uint256\",\"name\":\"tokenId\",\"indexed\":true}]},{\"type\":\"function\",\"name\":\"MINT_PRICE\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"approve\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"to\"},{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"balanceOf\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"owner\"}],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"getApproved\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"isApprovedForAll\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"owner\"},{\"type\":\"address\",\"name\":\"operator\"}],\"outputs\":[{\"type\":\"bool\"}]},{\"type\":\"function\",\"name\":\"maxSupply\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"mint\",\"constant\":false,\"stateMutability\":\"payable\",\"payable\":true,\"inputs\":[{\"type\":\"address\",\"name\":\"to\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"name\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"owner\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"ownerOf\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"render_3d\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"_tokenTransferCount\"},{\"type\":\"uint256\",\"name\":\"_tokenMintTimestamp\"},{\"type\":\"uint256\",\"name\":\"_lastTransferTimestamp\"},{\"type\":\"uint256\",\"name\":\"_totalTradeVolume\"},{\"type\":\"uint256\",\"name\":\"_tokenID\"}],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"render_deck\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"_tokenTransferCount\"},{\"type\":\"uint256\",\"name\":\"_tokenMintTimestamp\"},{\"type\":\"uint256\",\"name\":\"_lastTransferTimestamp\"},{\"type\":\"uint256\",\"name\":\"_totalTradeVolume\"},{\"type\":\"uint256\",\"name\":\"_tokenID\"}],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"render_schrift\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"_tokenTransferCount\"},{\"type\":\"uint256\",\"name\":\"_tokenMintTimestamp\"},{\"type\":\"uint256\",\"name\":\"_lastTransferTimestamp\"},{\"type\":\"uint256\",\"name\":\"_totalTradeVolume\"},{\"type\":\"uint256\",\"name\":\"_tokenID\"}],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"renounceOwnership\",\"constant\":false,\"payable\":false,\"inputs\":[],\"outputs\":[]},{\"type\":\"function\",\"name\":\"royaltyInfo\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"_tokenId\"},{\"type\":\"uint256\",\"name\":\"_salePrice\"}],\"outputs\":[{\"type\":\"address\",\"name\":\"receiver\"},{\"type\":\"uint256\",\"name\":\"royaltyAmount\"}]},{\"type\":\"function\",\"name\":\"safeTransferFrom\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"from\"},{\"type\":\"address\",\"name\":\"to\"},{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"safeTransferFrom\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"from\"},{\"type\":\"address\",\"name\":\"to\"},{\"type\":\"uint256\",\"name\":\"tokenId\"},{\"type\":\"bytes\",\"name\":\"data\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"scriptyBuilderAddress\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"scriptyStorageAddress\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"address\"}]},{\"type\":\"function\",\"name\":\"setApprovalForAll\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"operator\"},{\"type\":\"bool\",\"name\":\"approved\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"setRoyaltyReceiver\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"_receiver\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"supportsInterface\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"bytes4\",\"name\":\"interfaceId\"}],\"outputs\":[{\"type\":\"bool\"}]},{\"type\":\"function\",\"name\":\"symbol\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"tokenData\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\"}],\"outputs\":[{\"type\":\"uint256\",\"name\":\"transferCount\"},{\"type\":\"uint256\",\"name\":\"mintTimestamp\"},{\"type\":\"bytes32\",\"name\":\"seed\"},{\"type\":\"uint256\",\"name\":\"lastTransferTimestamp\"}]},{\"type\":\"function\",\"name\":\"tokenURI\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[{\"type\":\"string\"}]},{\"type\":\"function\",\"name\":\"totalMintedSoFar\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"totalTradeVolume\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"transferCount\",\"constant\":true,\"stateMutability\":\"view\",\"payable\":false,\"inputs\":[],\"outputs\":[{\"type\":\"uint256\"}]},{\"type\":\"function\",\"name\":\"transferFrom\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"from\"},{\"type\":\"address\",\"name\":\"to\"},{\"type\":\"uint256\",\"name\":\"tokenId\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"transferOwnership\",\"constant\":false,\"payable\":false,\"inputs\":[{\"type\":\"address\",\"name\":\"newOwner\"}],\"outputs\":[]},{\"type\":\"function\",\"name\":\"withdraw\",\"constant\":false,\"payable\":false,\"inputs\":[],\"outputs\":[]}]"];
            
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            const contract = new ethers.Contract(contractAddress, contractABI, signer);

            try {
                const tx = await contract.mint(connectedAccount);
                console.log("Mint transaction sent:", tx);
                await tx.wait();
                console.log("Mint transaction confirmed:", tx);
                // Aktualisieren Sie die Anzahl der geminteten NFTs
                totalMinted += 1;
                updateMintInfo();
            } catch (error) {
                console.error("Minting failed:", error);
            }
        }

        // Initialisiere die Mint-Info und Wallet-Anzeige beim Laden der Seite
        window.onload = () => {
            updateMintInfo();
        };
    </script>
</body>
</html>
